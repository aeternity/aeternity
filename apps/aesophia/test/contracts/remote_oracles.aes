contract Oracles =

  function registerOracle :
    (address,
     signature,
     int,
     int) => oracle(string, int)

  function createQuery :
    (oracle(string, int),
     string,
     int,
     int,
     int) => oracle_query(string, int)

  function unsafeCreateQuery :
    (oracle(string, int),
     string,
     int,
     int,
     int) => oracle_query(string, int)

  function respond :
    (oracle(string, int),
     oracle_query(string, int),
     signature,
     int) => ()

contract OraclesErr =

  function unsafeCreateQueryThenErr :
    (oracle(string, int),
     string,
     int,
     int,
     int) => oracle_query(string, int)

contract RemoteOracles =

  public function callRegisterOracle(
      r    : Oracles,
      acct : address,
      sign : signature,
      qfee : int,
      ttl  : int) : oracle(string, int) =
    r.registerOracle(acct, sign, qfee, ttl)

  public function callCreateQuery(
    r     : Oracles,
    value : int,
    o     : oracle(string, int),
    q     : string,
    qfee  : int,
    qttl  : int,
    rttl  : int) : oracle_query(string, int) =
    require(value =< Call.value, "insufficient value")
    r.createQuery(value = value, o, q, qfee, qttl, rttl)

  // Do not use in production!
  public function callUnsafeCreateQuery(
    r     : Oracles,
    value : int,
    o     : oracle(string, int),
    q     : string,
    qfee  : int,
    qttl  : int,
    rttl  : int) : oracle_query(string, int) =
    r.unsafeCreateQuery(value = value, o, q, qfee, qttl, rttl)

  // Do not use in production!
  public function callUnsafeCreateQueryThenErr(
    r     : OraclesErr,
    value : int,
    o     : oracle(string, int),
    q     : string,
    qfee  : int,
    qttl  : int,
    rttl  : int) : oracle_query(string, int) =
    r.unsafeCreateQueryThenErr(value = value, o, q, qfee, qttl, rttl)

  // Do not use in production!
  public function callUnsafeCreateQueryAndThenErr(
    r     : Oracles,
    value : int,
    o     : oracle(string, int),
    q     : string,
    qfee  : int,
    qttl  : int,
    rttl  : int) : oracle_query(string, int) =
    let x = r.unsafeCreateQuery(value = value, o, q, qfee, qttl, rttl)
    switch(0) 1 => ()
    x // Never reached.

  public function callRespond(
    r    : Oracles,
    o    : oracle(string, int),
    q    : oracle_query(string, int),
    sign : signature,
    qr   : int) =
    r.respond(o, q, sign, qr)

  private function abort(err : string) =
    switch(0) 1 => ()

  private function require(b : bool, err : string) =
    if(!b) abort(err)
