* Fixes a bug in commitments production - there was a race condition that
  could lead to deadlocks
